<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§¥ ì „ìš© íˆ¬ì ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fa; }
        .card { border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .status-running { background-color: #28a745; }
        .status-stopped { background-color: #dc3545; }
        .profit-positive { color: #28a745; }
        .profit-negative { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container-fluid mt-3">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0">
                            ğŸ ë§¥ ì „ìš© íˆ¬ì ëŒ€ì‹œë³´ë“œ
                            <span class="status-indicator status-running" id="serverStatus"></span>
                            <small class="float-end" id="lastUpdate"></small>
                        </h4>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-3">
            <!-- í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½ -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ“Š í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <h6>ì´ ìì‚°</h6>
                                <h4 id="totalValue">â‚©0</h4>
                            </div>
                            <div class="col-6">
                                <h6>ìˆ˜ìµë¥ </h6>
                                <h4 id="profitRate" class="profit-positive">0%</h4>
                            </div>
                        </div>
                        <div class="mt-3">
                            <h6>ì´ ìˆ˜ìµ</h6>
                            <h4 id="totalProfit" class="profit-positive">â‚©0</h4>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ì‹¤ì‹œê°„ ì£¼ê°€ -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ“ˆ ì‹¤ì‹œê°„ ì£¼ê°€</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>ì¢…ëª©ì½”ë“œ</th>
                                        <th>í˜„ì¬ê°€</th>
                                        <th>ë³€ë™</th>
                                        <th>ê±°ë˜ëŸ‰</th>
                                    </tr>
                                </thead>
                                <tbody id="stockTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-3">
            <!-- íˆ¬ì ì‹ í˜¸ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ¯ íˆ¬ì ì‹ í˜¸</h5>
                    </div>
                    <div class="card-body">
                        <div id="signalsList">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ë‰´ìŠ¤ -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>ğŸ“° ìµœì‹  ë‰´ìŠ¤</h5>
                    </div>
                    <div class="card-body">
                        <div id="newsList">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ì œì–´ íŒ¨ë„ -->
        <div class="row mt-3">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>âš™ï¸ ì œì–´ íŒ¨ë„</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success me-2" onclick="startVirtualData()">ê°€ìƒ ë°ì´í„° ì‹œì‘</button>
                        <button class="btn btn-danger me-2" onclick="stopVirtualData()">ê°€ìƒ ë°ì´í„° ì¤‘ì§€</button>
                        <button class="btn btn-primary" onclick="refreshData()">ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let updateInterval;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            updateInterval = setInterval(refreshData, 5000); // 5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
        });
        
        async function refreshData() {
            try {
                // ì„œë²„ ìƒíƒœ í™•ì¸
                const statusResponse = await fetch('/api/status');
                const status = await statusResponse.json();
                
                // ì£¼ì‹ ë°ì´í„°
                const stockResponse = await fetch('/api/stock-data');
                const stockData = await stockResponse.json();
                
                // í¬íŠ¸í´ë¦¬ì˜¤ ë°ì´í„°
                const portfolioResponse = await fetch('/api/portfolio');
                const portfolio = await portfolioResponse.json();
                
                // íˆ¬ì ì‹ í˜¸
                const signalsResponse = await fetch('/api/signals');
                const signals = await signalsResponse.json();
                
                // ë‰´ìŠ¤ ë°ì´í„°
                const newsResponse = await fetch('/api/news');
                const news = await newsResponse.json();
                
                // UI ì—…ë°ì´íŠ¸
                updateUI(status, stockData, portfolio, signals, news);
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        function updateUI(status, stockData, portfolio, signals, news) {
            // ì„œë²„ ìƒíƒœ
            document.getElementById('serverStatus').className = 
                `status-indicator ${status.virtual_data_running ? 'status-running' : 'status-stopped'}`;
            
            // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
            document.getElementById('lastUpdate').textContent = 
                new Date().toLocaleTimeString();
            
            // í¬íŠ¸í´ë¦¬ì˜¤ ì—…ë°ì´íŠ¸
            document.getElementById('totalValue').textContent = 
                `â‚©${portfolio.total_value.toLocaleString()}`;
            document.getElementById('totalProfit').textContent = 
                `â‚©${portfolio.total_profit.toLocaleString()}`;
            document.getElementById('profitRate').textContent = 
                `${(portfolio.profit_rate * 100).toFixed(2)}%`;
            
            // ìˆ˜ìµë¥  ìƒ‰ìƒ
            const profitRateElement = document.getElementById('profitRate');
            const totalProfitElement = document.getElementById('totalProfit');
            if (portfolio.profit_rate >= 0) {
                profitRateElement.className = 'profit-positive';
                totalProfitElement.className = 'profit-positive';
            } else {
                profitRateElement.className = 'profit-negative';
                totalProfitElement.className = 'profit-negative';
            }
            
            // ì£¼ì‹ í…Œì´ë¸” ì—…ë°ì´íŠ¸
            updateStockTable(stockData);
            
            // íˆ¬ì ì‹ í˜¸ ì—…ë°ì´íŠ¸
            updateSignalsList(signals);
            
            // ë‰´ìŠ¤ ì—…ë°ì´íŠ¸
            updateNewsList(news);
        }
        
        function updateStockTable(stockData) {
            const tbody = document.getElementById('stockTable');
            tbody.innerHTML = '';
            
            Object.entries(stockData).forEach(([code, data]) => {
                const row = document.createElement('tr');
                const changeClass = data.change >= 0 ? 'profit-positive' : 'profit-negative';
                const changeSymbol = data.change >= 0 ? '+' : '';
                
                row.innerHTML = `
                    <td><strong>${code}</strong></td>
                    <td>â‚©${data.current_price.toLocaleString()}</td>
                    <td class="${changeClass}">${changeSymbol}${data.change.toLocaleString()}</td>
                    <td>${data.volume.toLocaleString()}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateSignalsList(signals) {
            const container = document.getElementById('signalsList');
            container.innerHTML = '';
            
            signals.forEach(signal => {
                const signalElement = document.createElement('div');
                signalElement.className = 'alert alert-info mb-2';
                signalElement.innerHTML = `
                    <strong>${signal.name} (${signal.code})</strong><br>
                    ì‹ í˜¸: <span class="badge bg-primary">${signal.signal}</span>
                    ì‹ ë¢°ë„: ${(signal.confidence * 100).toFixed(1)}%
                    ëª©í‘œê°€: â‚©${signal.target_price.toLocaleString()}
                `;
                container.appendChild(signalElement);
            });
        }
        
        function updateNewsList(news) {
            const container = document.getElementById('newsList');
            container.innerHTML = '';
            
            news.forEach(item => {
                const newsElement = document.createElement('div');
                newsElement.className = 'alert alert-secondary mb-2';
                const sentimentClass = item.sentiment === 'positive' ? 'text-success' : 'text-danger';
                newsElement.innerHTML = `
                    <div class="${sentimentClass}"><strong>${item.title}</strong></div>
                    <small class="text-muted">${new Date(item.timestamp).toLocaleString()}</small>
                `;
                container.appendChild(newsElement);
            });
        }
        
        async function startVirtualData() {
            try {
                await fetch('/api/start-virtual-data', { method: 'POST' });
                alert('ê°€ìƒ ë°ì´í„° ìƒì„±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert('ê°€ìƒ ë°ì´í„° ì‹œì‘ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        async function stopVirtualData() {
            try {
                await fetch('/api/stop-virtual-data', { method: 'POST' });
                alert('ê°€ìƒ ë°ì´í„° ìƒì„±ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert('ê°€ìƒ ë°ì´í„° ì¤‘ì§€ ì‹¤íŒ¨: ' + error.message);
            }
        }
    </script>
</body>
</html>